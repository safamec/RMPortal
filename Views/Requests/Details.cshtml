@model MediaAccessRequest
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewData["Title"] = $"Request {Model.RequestNumber}";
}

<div class="container py-5">
    <div class="card shadow-lg rounded-3 border-0 details-card">
        <div class="card-body p-5">
            <h2 class="card-title mb-4">Request @Model.RequestNumber</h2>
            <hr class="section-divider" />

            <div class="info-section">
                <div class="info-item"><b>Status:</b> @Model.Status</div>
                <div class="info-item"><b>Requester:</b> @Model.Name (@Model.LoginName)</div>
                <div class="info-item"><b>Department:</b> @Model.Department</div>
                <div class="info-item"><b>Employment Status:</b> @Model.EmploymentStatus</div>
                <div class="info-item"><b>Employee Number / Employer:</b> @Model.EmployeeNumberOrEmployer</div>
                <div class="info-item"><b>Title:</b> @Model.Title</div>
                <div class="info-item"><b>Office Ext:</b> @Model.OfficeExtension</div>
                <div class="info-item"><b>Directorate:</b> @Model.Directorate</div>
                <div class="info-item"><b>User Machine ID:</b> @Model.UserMachineId</div>

                <div class="row mt-3">
                    <div class="col-md-6 info-item">
                        <b>Start Date:</b> @(Model.StartDate?.ToString("yyyy-MM-dd") ?? "-")
                    </div>
                    <div class="col-md-6 info-item">
                        <b>End Date:</b> @(Model.EndDate?.ToString("yyyy-MM-dd") ?? "-")
                    </div>
                </div>

                <div class="mt-3 info-item"><b>Classification:</b> @Model.Classification</div>

                <div class="mt-3 info-item">
                    <b>Justification:</b>
                    <div class="justification-box">@Model.Justification</div>
                </div>
            </div>

            <hr class="section-divider my-4" />

            <h4 class="sub-title">Approval History</h4>
            @if (Model.Decisions?.Any() == true)
            {
                <div class="table-container">
                    <table class="table custom-table align-middle">
                        <thead>
                            <tr>
                                <th>Stage</th>
                                <th>Decision</th>
                                <th>By</th>
                                <th>At</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var d in Model.Decisions.OrderBy(d => d.DecidedAt))
                        {
                            <tr>
                                <td>@d.Stage</td>
                                <td>@d.Decision</td>
                                <td>@d.DecidedBySam</td>
                                <td>@d.DecidedAt?.ToString("yyyy-MM-dd HH:mm")</td>
                                <td>@d.Notes</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p class="text-muted">No decisions yet.</p>
            }

            <div class="mt-4 text-left">
                <a class="btn btn-outline-secondary btn-sm rounded-pill px-4" 
                   asp-controller="Home" asp-action="Index">Back to Home</a>
            </div>
        </div>
    </div>
</div>

<style>
    /* --- Page Card --- */
    .details-card {
        background: rgba(255,255,255,0.97);
        border: 1px solid #33c5ba33;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
    }

    /* --- Titles --- */
    .card-title {
        color: #009b94;
        font-weight: 700;
        font-size: 1.6rem;
    }

    .sub-title {
        color: #009b94;
        font-weight: 600;
        margin-bottom: 0.8rem;
        font-size: 1.1rem;
    }

    .section-divider {
        border: 0;
        height: 1.5px;
        background: linear-gradient(to right, #33c5ba33, #009b94, #33c5ba33);
    }

    /* --- Info Section --- */
    .info-section {
        font-size: 0.96rem;
        color: #333;
    }

    .info-item {
        margin-bottom: 8px;
        border-bottom: 1px solid #eaeaea;
        padding-bottom: 5px;
    }

    .justification-box {
        background-color: #f8fdfd;
        border: 1px solid #33c5ba;
        border-radius: 8px;
        padding: 10px;
        margin-top: 5px;
        white-space: pre-wrap;
    }

    /* --- Table --- */
    .table-container {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .custom-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.95rem;
    }

    .custom-table th {
        background-color: #009b94;
        color: white;
        border: none;
        padding: 12px 10px;
        text-align: left;
        font-weight: 500;
    }

    .custom-table td {
        border-top: 1px solid #33c5ba;
        padding: 10px;
        color: #333;
        vertical-align: middle;
    }

    .custom-table tr:hover {
        background-color: #f4fbfa;
        transition: background-color 0.2s ease;
    }

    /* --- Buttons --- */
    .btn-outline-secondary {
        border: 1px solid #2daca2;
        color: #009b94;
        font-weight: 600;
        background-color: transparent;
        transition: 0.25s;
        

    }

    .btn-outline-secondary:hover {
        background-color: #2daca2;
        color: white;
    }

    /* --- Misc --- */
    .text-muted {
        color: #666;
        font-size: 0.95rem;
    }
</style>
